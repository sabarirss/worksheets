<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - Practice Worksheets</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .settings-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
        }

        .settings-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 2px solid #f0f0f0;
        }

        .settings-header h1 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 2.5em;
        }

        .settings-header p {
            color: #666;
            margin: 0;
        }

        .settings-section {
            margin-bottom: 40px;
        }

        .settings-section h2 {
            color: #667eea;
            font-size: 1.5em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
            font-size: 1em;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            box-sizing: border-box;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group input:disabled {
            background: #f5f5f5;
            cursor: not-allowed;
        }

        .info-text {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .protected-field {
            position: relative;
        }

        .lock-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2em;
            color: #667eea;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #f0f0f0;
        }

        .parent-control-box {
            background: #f8f9fa;
            border: 2px solid #667eea;
            border-radius: 12px;
            padding: 20px;
            margin-top: 15px;
        }

        .parent-control-box h3 {
            margin: 0 0 15px 0;
            color: #667eea;
            font-size: 1.2em;
        }

        .age-guidelines {
            background: #f0f4ff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .age-guidelines h4 {
            color: #667eea;
            margin: 0 0 10px 0;
        }

        .age-guidelines ul {
            margin: 10px 0;
            padding-left: 20px;
            color: #666;
            font-size: 0.9em;
        }

        .age-guidelines li {
            margin: 5px 0;
        }

        .module-badge {
            display: inline-block;
            margin: 5px;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.9em;
            background: #e3f2fd;
            color: #1976d2;
            font-weight: bold;
        }

        .module-badge.disabled {
            background: #fafafa;
            color: #999;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            border: 1px solid #c3e6cb;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            border: 1px solid #f5c6cb;
        }
    </style>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <!-- Firebase Config -->
    <script src="firebase-config.js"></script>

    <!-- Firebase Auth -->
    <script src="firebase-auth.js"></script>
    <script src="age-filter.js"></script>
</head>
<body>
    <div class="settings-container">
        <div class="settings-header">
            <h1>‚öôÔ∏è Settings</h1>
            <p>Manage your profile and preferences</p>
        </div>

        <div class="success-message" id="success-message"></div>
        <div class="error-message" id="error-message"></div>

        <!-- Profile Information -->
        <div class="settings-section">
            <h2>üë§ Profile Information</h2>

            <div class="form-group">
                <label for="username">Username</label>
                <input type="text" id="username" disabled>
                <div class="info-text">Username cannot be changed</div>
            </div>

            <div class="form-group">
                <label for="fullname">Full Name</label>
                <input type="text" id="fullname" placeholder="Enter your full name">
            </div>

            <div class="form-group">
                <label for="email">Email Address</label>
                <input type="email" id="email" disabled>
                <div class="info-text">Email cannot be changed</div>
            </div>

            <div class="form-group">
                <label for="role">Account Type</label>
                <input type="text" id="role" disabled>
                <div class="info-text">Only admins can change account types</div>
            </div>
        </div>

        <!-- Age Settings with Parent Control -->
        <div class="settings-section">
            <h2>üë®‚Äçüë©‚Äçüëß Age Settings & Parent Control</h2>

            <div class="parent-control-box">
                <h3>üîí Protected by Parent PIN</h3>
                <p style="color: #666; margin-bottom: 15px;">Age settings affect which content your child can access. Changes require parent verification.</p>

                <div class="form-group">
                    <label for="current-age-display">Current Age</label>
                    <input type="text" id="current-age-display" disabled style="font-size: 1.1em; font-weight: bold; color: #667eea;">
                </div>

                <button class="btn btn-primary" onclick="openChangeAgeModal()" style="width: 100%;">
                    üîê Change Age (Requires Parent PIN)
                </button>

                <div class="age-guidelines">
                    <h4>Age-Based Content Access:</h4>
                    <ul>
                        <li><strong>Ages 4-5:</strong> Math/English 6A only, Easy stories & aptitude</li>
                        <li><strong>Age 6:</strong> Math/English 6A-5A, Easy content, German Kids available</li>
                        <li><strong>Age 7:</strong> Math/English 6A-4A, Easy + Medium, Emotional Quotient available</li>
                        <li><strong>Age 8:</strong> Math/English 6A-3A, Easy + Medium content</li>
                        <li><strong>Age 9+:</strong> All math/English (6A-2A), Easy + Medium + Hard content</li>
                        <li><strong>Age 10+:</strong> All content including German B1 (adult level)</li>
                    </ul>
                    <p style="font-size: 0.85em; color: #888; margin: 10px 0 0 0;">Note: In Kumon system, 6A is easiest, 2A is hardest</p>
                </div>
            </div>
        </div>

        <!-- Module Access Management -->
        <div class="settings-section">
            <h2>üìö Module Access & Parent Control</h2>

            <div class="parent-control-box">
                <h3>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Manage Learning Modules</h3>
                <p style="color: #666; margin-bottom: 15px;">
                    Parents can enable or disable learning modules. Enable modules you want your child to access.
                    Requires parent verification.
                </p>

                <button class="btn btn-primary" onclick="openModuleManagementModal()" style="width: 100%;">
                    üîê Manage Modules (Requires Parent PIN)
                </button>

                <div style="margin-top: 20px;">
                    <h4 style="color: #667eea; margin-bottom: 10px;">Currently Available Modules:</h4>
                    <div id="modules-display"></div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="btn btn-secondary" onclick="window.location.href='index.html'">
                ‚Üê Back to Home
            </button>
            <button class="btn btn-primary" onclick="saveProfile()">
                üíæ Save Changes
            </button>
        </div>
    </div>

    <!-- Change Age Modal -->
    <div class="modal" id="change-age-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; align-items: center; justify-content: center;">
        <div style="background: white; border-radius: 20px; padding: 40px; max-width: 400px; width: 90%;">
            <h2 style="margin-top: 0; color: #667eea;">üîí Parent Verification</h2>
            <p style="color: #666; margin-bottom: 20px;">Enter your 4-digit parent PIN to change age settings.</p>

            <div style="margin: 20px 0;">
                <label style="display: block; font-weight: bold; color: #333; margin-bottom: 10px;">Parent PIN:</label>
                <input
                    type="password"
                    id="verify-pin-input"
                    maxlength="4"
                    placeholder="Enter 4-digit PIN"
                    style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 8px; font-size: 1.5em; text-align: center; letter-spacing: 10px; box-sizing: border-box;"
                    inputmode="numeric"
                    pattern="[0-9]*"
                >
            </div>

            <div style="margin: 20px 0;">
                <label style="display: block; font-weight: bold; color: #333; margin-bottom: 10px;">New Age:</label>
                <select id="new-age-select" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em; box-sizing: border-box;">
                    <option value="">Select new age</option>
                    <option value="4">4 years old</option>
                    <option value="5">5 years old</option>
                    <option value="6">6 years old</option>
                    <option value="7">7 years old</option>
                    <option value="8">8 years old</option>
                    <option value="9">9 years old</option>
                    <option value="10">10 years old</option>
                    <option value="11">11 years old</option>
                    <option value="12">12 years old</option>
                    <option value="13">13+ years old</option>
                </select>
            </div>

            <div id="age-change-error" style="color: #e74c3c; font-weight: bold; margin: 10px 0; display: none;"></div>

            <div style="display: flex; gap: 10px; margin-top: 30px;">
                <button onclick="submitAgeChange()" class="btn btn-primary" style="flex: 1;">
                    Verify & Change
                </button>
                <button onclick="closeChangeAgeModal()" class="btn btn-secondary" style="flex: 1;">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Module Management Modal -->
    <div class="modal" id="module-management-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; align-items: center; justify-content: center;">
        <div style="background: white; border-radius: 20px; padding: 40px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto;">
            <h2 style="margin-top: 0; color: #667eea;">üîí Parent Verification</h2>
            <p style="color: #666; margin-bottom: 20px;">Enter your 4-digit parent PIN to manage module access.</p>

            <div style="margin: 20px 0;">
                <label style="display: block; font-weight: bold; color: #333; margin-bottom: 10px;">Parent PIN:</label>
                <input
                    type="password"
                    id="module-pin-input"
                    maxlength="4"
                    placeholder="Enter 4-digit PIN"
                    style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 8px; font-size: 1.5em; text-align: center; letter-spacing: 10px; box-sizing: border-box;"
                    inputmode="numeric"
                    pattern="[0-9]*"
                >
            </div>

            <div id="module-error" style="color: #e74c3c; font-weight: bold; margin: 10px 0; display: none;"></div>

            <!-- Module toggles (hidden until PIN verified) -->
            <div id="module-toggles" style="display: none;">
                <h3 style="color: #667eea; margin: 20px 0;">Enable/Disable Modules:</h3>
                <div style="display: grid; gap: 10px;">
                    <label style="display: flex; align-items: center; padding: 15px; background: #f8f9fa; border-radius: 8px; cursor: pointer;">
                        <input type="checkbox" id="toggle-math" onchange="updateModuleState()" style="width: 20px; height: 20px; margin-right: 10px;">
                        <span style="font-size: 1.1em;">üìê Mathematics</span>
                    </label>
                    <label style="display: flex; align-items: center; padding: 15px; background: #f8f9fa; border-radius: 8px; cursor: pointer;">
                        <input type="checkbox" id="toggle-english" onchange="updateModuleState()" style="width: 20px; height: 20px; margin-right: 10px;">
                        <span style="font-size: 1.1em;">üìö English</span>
                    </label>
                    <label style="display: flex; align-items: center; padding: 15px; background: #f8f9fa; border-radius: 8px; cursor: pointer;">
                        <input type="checkbox" id="toggle-aptitude" onchange="updateModuleState()" style="width: 20px; height: 20px; margin-right: 10px;">
                        <span style="font-size: 1.1em;">üß© Aptitude</span>
                    </label>
                    <label style="display: flex; align-items: center; padding: 15px; background: #f8f9fa; border-radius: 8px; cursor: pointer;">
                        <input type="checkbox" id="toggle-stories" onchange="updateModuleState()" style="width: 20px; height: 20px; margin-right: 10px;">
                        <span style="font-size: 1.1em;">üìñ Stories</span>
                    </label>
                    <label style="display: flex; align-items: center; padding: 15px; background: #f8f9fa; border-radius: 8px; cursor: pointer;">
                        <input type="checkbox" id="toggle-emotional-quotient" onchange="updateModuleState()" style="width: 20px; height: 20px; margin-right: 10px;">
                        <span style="font-size: 1.1em;">‚ù§Ô∏è Emotional Quotient</span>
                    </label>
                    <label style="display: flex; align-items: center; padding: 15px; background: #f8f9fa; border-radius: 8px; cursor: pointer;">
                        <input type="checkbox" id="toggle-drawing" onchange="updateModuleState()" style="width: 20px; height: 20px; margin-right: 10px;">
                        <span style="font-size: 1.1em;">üé® Drawing</span>
                    </label>
                    <label style="display: flex; align-items: center; padding: 15px; background: #f8f9fa; border-radius: 8px; cursor: pointer;">
                        <input type="checkbox" id="toggle-german-kids" onchange="updateModuleState()" style="width: 20px; height: 20px; margin-right: 10px;">
                        <span style="font-size: 1.1em;">üá©üá™ German Kids</span>
                    </label>
                    <div style="background: #fff3cd; padding: 10px; border-radius: 8px; margin-top: 10px;">
                        <p style="margin: 0; font-size: 0.9em; color: #856404;">
                            <strong>Note:</strong> German B1 (adult level) can only be enabled by an admin.
                        </p>
                    </div>
                </div>
            </div>

            <div style="display: flex; gap: 10px; margin-top: 30px;">
                <button onclick="verifyModulePin()" id="verify-module-btn" class="btn btn-primary" style="flex: 1;">
                    Verify PIN
                </button>
                <button onclick="saveModuleChanges()" id="save-modules-btn" class="btn btn-primary" style="flex: 1; display: none;">
                    üíæ Save Changes
                </button>
                <button onclick="closeModuleManagementModal()" class="btn btn-secondary" style="flex: 1;">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;
        let moduleChanges = {};

        // Wait for Firebase auth
        firebase.auth().onAuthStateChanged(async function(user) {
            if (!user) {
                window.location.href = 'login.html';
                return;
            }

            await loadUserProfile();
        });

        async function loadUserProfile() {
            const user = getCurrentUser && getCurrentUser();
            if (!user) {
                showError('Failed to load user data');
                return;
            }

            currentUser = user;

            // Populate fields
            document.getElementById('username').value = user.username || '';
            document.getElementById('fullname').value = user.fullName || '';
            document.getElementById('email').value = user.email || '';
            document.getElementById('role').value = user.role || 'student';

            // Display current age
            const ageDisplay = user.age ? `${user.age} years old` : 'Not set';
            document.getElementById('current-age-display').value = ageDisplay;

            // Display modules
            displayModules(user.modules || {});
        }

        function displayModules(modules) {
            const moduleNames = {
                math: 'üìê Mathematics',
                english: 'üìö English',
                aptitude: 'üß© Aptitude',
                stories: 'üìñ Stories',
                'emotional-quotient': '‚ù§Ô∏è Emotional Quotient',
                german: 'üá©üá™ German B1',
                drawing: 'üé® Drawing',
                'german-kids': 'üá©üá™ German Kids'
            };

            let html = '<div style="display: flex; flex-wrap: wrap;">';

            for (const [key, enabled] of Object.entries(modules)) {
                const name = moduleNames[key] || key;
                html += `<span class="module-badge ${enabled ? '' : 'disabled'}">${name}</span>`;
            }

            html += '</div>';

            if (Object.keys(modules).length === 0) {
                html = '<p style="color: #999;">No modules assigned yet. Contact admin to enable modules.</p>';
            }

            document.getElementById('modules-display').innerHTML = html;
        }

        async function saveProfile() {
            if (!currentUser) return;

            const fullName = document.getElementById('fullname').value.trim();

            if (!fullName) {
                showError('Full name is required');
                return;
            }

            try {
                const userDoc = firebase.firestore().collection('users').doc(currentUser.uid.substring(0, 20));
                await userDoc.update({
                    fullName: fullName
                });

                // Update cache
                if (currentUserCache) {
                    currentUserCache.fullName = fullName;
                }

                showSuccess('Profile updated successfully!');
            } catch (error) {
                console.error('Error updating profile:', error);
                showError('Failed to update profile: ' + error.message);
            }
        }

        function openChangeAgeModal() {
            document.getElementById('change-age-modal').style.display = 'flex';
            document.getElementById('verify-pin-input').value = '';
            document.getElementById('new-age-select').value = '';
            document.getElementById('age-change-error').style.display = 'none';

            setTimeout(() => {
                document.getElementById('verify-pin-input').focus();
            }, 100);
        }

        function closeChangeAgeModal() {
            document.getElementById('change-age-modal').style.display = 'none';
        }

        async function submitAgeChange() {
            const pin = document.getElementById('verify-pin-input').value.trim();
            const newAge = document.getElementById('new-age-select').value;
            const errorDiv = document.getElementById('age-change-error');

            // Validate PIN
            if (!pin || pin.length !== 4 || !/^\d{4}$/.test(pin)) {
                errorDiv.textContent = 'Please enter a valid 4-digit PIN';
                errorDiv.style.display = 'block';
                return;
            }

            // Validate age selection
            if (!newAge) {
                errorDiv.textContent = 'Please select a new age';
                errorDiv.style.display = 'block';
                return;
            }

            // Verify PIN
            const isValid = await verifyParentPin(pin);

            if (!isValid) {
                errorDiv.textContent = 'Incorrect PIN. Please try again.';
                errorDiv.style.display = 'block';
                document.getElementById('verify-pin-input').value = '';
                document.getElementById('verify-pin-input').focus();
                return;
            }

            // Update age
            try {
                const userDoc = firebase.firestore().collection('users').doc(currentUser.uid.substring(0, 20));
                await userDoc.update({
                    age: parseInt(newAge)
                });

                // Update cache
                if (currentUserCache) {
                    currentUserCache.age = parseInt(newAge);
                }

                closeChangeAgeModal();
                showSuccess('Age updated successfully! Page will reload to apply new content filters.');

                // Reload after 2 seconds
                setTimeout(() => {
                    window.location.reload();
                }, 2000);
            } catch (error) {
                console.error('Error updating age:', error);
                errorDiv.textContent = 'Failed to update age: ' + error.message;
                errorDiv.style.display = 'block';
            }
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('success-message');
            successDiv.textContent = message;
            successDiv.style.display = 'block';

            // Hide error message
            document.getElementById('error-message').style.display = 'none';

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });

            // Auto-hide after 5 seconds
            setTimeout(() => {
                successDiv.style.display = 'none';
            }, 5000);
        }

        function showError(message) {
            const errorDiv = document.getElementById('error-message');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';

            // Hide success message
            document.getElementById('success-message').style.display = 'none';

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Module Management Functions
        function openModuleManagementModal() {
            document.getElementById('module-management-modal').style.display = 'flex';
            document.getElementById('module-pin-input').value = '';
            document.getElementById('module-error').style.display = 'none';
            document.getElementById('module-toggles').style.display = 'none';
            document.getElementById('verify-module-btn').style.display = 'block';
            document.getElementById('save-modules-btn').style.display = 'none';
            moduleChanges = {};

            setTimeout(() => {
                document.getElementById('module-pin-input').focus();
            }, 100);
        }

        function closeModuleManagementModal() {
            document.getElementById('module-management-modal').style.display = 'none';
        }

        async function verifyModulePin() {
            const pin = document.getElementById('module-pin-input').value.trim();
            const errorDiv = document.getElementById('module-error');

            if (!pin || pin.length !== 4 || !/^\d{4}$/.test(pin)) {
                errorDiv.textContent = 'Please enter a valid 4-digit PIN';
                errorDiv.style.display = 'block';
                return;
            }

            const isValid = await verifyParentPin(pin);

            if (!isValid) {
                errorDiv.textContent = 'Incorrect PIN. Please try again.';
                errorDiv.style.display = 'block';
                document.getElementById('module-pin-input').value = '';
                document.getElementById('module-pin-input').focus();
                return;
            }

            // PIN verified - show module toggles
            errorDiv.style.display = 'none';
            document.getElementById('module-toggles').style.display = 'block';
            document.getElementById('verify-module-btn').style.display = 'none';
            document.getElementById('save-modules-btn').style.display = 'block';

            // Load current module states
            if (currentUser && currentUser.modules) {
                document.getElementById('toggle-math').checked = currentUser.modules.math || false;
                document.getElementById('toggle-english').checked = currentUser.modules.english || false;
                document.getElementById('toggle-aptitude').checked = currentUser.modules.aptitude || false;
                document.getElementById('toggle-stories').checked = currentUser.modules.stories || false;
                document.getElementById('toggle-emotional-quotient').checked = currentUser.modules['emotional-quotient'] || false;
                document.getElementById('toggle-drawing').checked = currentUser.modules.drawing || false;
                document.getElementById('toggle-german-kids').checked = currentUser.modules['german-kids'] || false;
            }
        }

        function updateModuleState() {
            // Track changes
            moduleChanges = {
                math: document.getElementById('toggle-math').checked,
                english: document.getElementById('toggle-english').checked,
                aptitude: document.getElementById('toggle-aptitude').checked,
                stories: document.getElementById('toggle-stories').checked,
                'emotional-quotient': document.getElementById('toggle-emotional-quotient').checked,
                drawing: document.getElementById('toggle-drawing').checked,
                'german-kids': document.getElementById('toggle-german-kids').checked
            };
        }

        async function saveModuleChanges() {
            if (!currentUser || Object.keys(moduleChanges).length === 0) {
                closeModuleManagementModal();
                return;
            }

            try {
                const userDoc = firebase.firestore().collection('users').doc(currentUser.uid.substring(0, 20));

                // Update each module
                const updates = {};
                for (const [key, value] of Object.entries(moduleChanges)) {
                    updates[`modules.${key}`] = value;
                }

                await userDoc.update(updates);

                // Update cache
                if (currentUserCache) {
                    currentUserCache.modules = { ...currentUserCache.modules, ...moduleChanges };
                }

                closeModuleManagementModal();
                showSuccess('Module access updated successfully! Page will reload to apply changes.');

                // Reload after 2 seconds
                setTimeout(() => {
                    window.location.reload();
                }, 2000);
            } catch (error) {
                console.error('Error updating modules:', error);
                document.getElementById('module-error').textContent = 'Failed to update modules: ' + error.message;
                document.getElementById('module-error').style.display = 'block';
            }
        }

        // Close modals on background click
        document.getElementById('change-age-modal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeChangeAgeModal();
            }
        });

        document.getElementById('module-management-modal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeModuleManagementModal();
            }
        });
    </script>
</body>
</html>
