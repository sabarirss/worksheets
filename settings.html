<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - Practice Worksheets</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .settings-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
        }

        .settings-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 2px solid #f0f0f0;
            position: relative;
        }

        .settings-header h1 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 2.5em;
        }

        .settings-header p {
            color: #666;
            margin: 0;
        }

        .close-btn {
            position: absolute;
            top: 0;
            right: 0;
            background: #f0f0f0;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.5em;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            color: #666;
        }

        .close-btn:hover {
            background: #e0e0e0;
            color: #333;
            transform: rotate(90deg);
        }

        .settings-section {
            margin-bottom: 40px;
        }

        .settings-section h2 {
            color: #667eea;
            font-size: 1.5em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
            font-size: 1em;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            box-sizing: border-box;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group input:disabled {
            background: #f5f5f5;
            cursor: not-allowed;
        }

        .info-text {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .protected-field {
            position: relative;
        }

        .lock-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2em;
            color: #667eea;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #f0f0f0;
        }

        .parent-control-box {
            background: #f8f9fa;
            border: 2px solid #667eea;
            border-radius: 12px;
            padding: 20px;
            margin-top: 15px;
        }

        .parent-control-box h3 {
            margin: 0 0 15px 0;
            color: #667eea;
            font-size: 1.2em;
        }

        .age-guidelines {
            background: #f0f4ff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .age-guidelines h4 {
            color: #667eea;
            margin: 0 0 10px 0;
        }

        .age-guidelines ul {
            margin: 10px 0;
            padding-left: 20px;
            color: #666;
            font-size: 0.9em;
        }

        .age-guidelines li {
            margin: 5px 0;
        }

        .module-badge {
            display: inline-block;
            margin: 5px;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.9em;
            background: #e3f2fd;
            color: #1976d2;
            font-weight: bold;
        }

        .module-badge.disabled {
            background: #fafafa;
            color: #999;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            border: 1px solid #c3e6cb;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            border: 1px solid #f5c6cb;
        }
    </style>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <!-- Firebase Config -->
    <script src="firebase-config.js"></script>

    <!-- Firebase Auth -->
    <script src="firebase-auth.js"></script>
    <script src="age-filter.js"></script>
</head>
<body>
    <div class="settings-container">
        <div class="settings-header">
            <button class="close-btn" onclick="window.location.href='index.html'" title="Close Settings">‚úï</button>
            <h1>‚öôÔ∏è Settings</h1>
            <p>Manage your profile and preferences</p>
        </div>

        <div class="success-message" id="success-message"></div>
        <div class="error-message" id="error-message"></div>

        <!-- Profile Information -->
        <div class="settings-section">
            <h2>üë§ Profile Information</h2>

            <div class="form-group">
                <label for="username">Username</label>
                <input type="text" id="username" disabled>
                <div class="info-text">Username cannot be changed</div>
            </div>

            <div class="form-group">
                <label for="fullname">Full Name</label>
                <input type="text" id="fullname" placeholder="Enter your full name">
            </div>

            <div class="form-group">
                <label for="email">Email Address</label>
                <input type="email" id="email" disabled>
                <div class="info-text">Email cannot be changed</div>
            </div>

            <div class="form-group">
                <label for="role">Account Type</label>
                <input type="text" id="role" disabled>
                <div class="info-text">Only admins can change account types</div>
            </div>
        </div>

        <!-- Current Child Age Display -->
        <div class="settings-section">
            <h2>üë∂ Child's Current Age</h2>
            <div class="form-group">
                <label for="current-age-display">Age</label>
                <input type="text" id="current-age-display" disabled style="font-size: 1.1em; font-weight: bold; color: #667eea;">
            </div>
            <div style="margin-top: 20px;">
                <h4 style="color: #667eea; margin-bottom: 10px;">Currently Available Modules:</h4>
                <div id="modules-display"></div>
            </div>
        </div>

        <!-- Parental Control Section -->
        <div class="settings-section">
            <h2>üë®‚Äçüë©‚Äçüëß Parental Control</h2>

            <div class="parent-control-box">
                <h3>üîí Age Settings & Module Management</h3>
                <p style="color: #666; margin-bottom: 15px;">
                    Parents can manage their child's age settings and learning modules. This affects which content your child can access.
                    Requires parent age verification (25 years or older).
                </p>

                <button class="btn btn-primary" onclick="openParentalControl()" style="width: 100%; font-size: 1.1em; padding: 15px;">
                    üîê Access Parental Control
                </button>

                <div class="age-guidelines" style="margin-top: 20px;">
                    <h4>Age-Based Content Access:</h4>
                    <ul>
                        <li><strong>Ages 4-5:</strong> Math/English 6A only, Easy stories & aptitude</li>
                        <li><strong>Age 6:</strong> Math/English 6A-5A, Easy content, German Kids available</li>
                        <li><strong>Age 7:</strong> Math/English 6A-4A, Easy + Medium, Emotional Quotient available</li>
                        <li><strong>Age 8:</strong> Math/English 6A-3A, Easy + Medium content</li>
                        <li><strong>Age 9+:</strong> All math/English (6A-2A), Easy + Medium + Hard content</li>
                        <li><strong>Age 10+:</strong> All content including German B1 (adult level)</li>
                    </ul>
                    <p style="font-size: 0.85em; color: #888; margin: 10px 0 0 0;">Note: 6A is the easiest level, 2A is the hardest level</p>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="btn btn-secondary" onclick="window.location.href='index.html'">
                ‚Üê Back to Home
            </button>
            <button class="btn btn-primary" onclick="saveProfile()">
                üíæ Save Changes
            </button>
        </div>
    </div>

    <!-- Parent Age Verification Modal -->
    <div class="modal" id="parent-verification-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; align-items: center; justify-content: center;">
        <div style="background: white; border-radius: 20px; padding: 40px; max-width: 500px; width: 90%;">
            <h2 style="margin-top: 0; color: #667eea;">üîí Parent Age Verification</h2>
            <p style="color: #666; margin-bottom: 20px; line-height: 1.6;">
                Parental Control allows you to manage your child's age settings and learning modules.
                To verify you are a parent/guardian, please enter your date of birth.
            </p>

            <div style="margin: 20px 0;">
                <label style="display: block; font-weight: bold; color: #333; margin-bottom: 10px;">Your Date of Birth:</label>
                <input
                    type="date"
                    id="parent-dob-input"
                    style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em; box-sizing: border-box;"
                >
            </div>

            <div id="parent-verification-error" style="color: #e74c3c; font-weight: bold; margin: 10px 0; display: none;"></div>

            <div style="display: flex; gap: 10px; margin-top: 30px;">
                <button onclick="verifyParentAge()" class="btn btn-primary" style="flex: 1;">
                    Verify & Continue
                </button>
                <button onclick="closeParentVerification()" class="btn btn-secondary" style="flex: 1;">
                    Cancel
                </button>
            </div>

            <div style="margin-top: 20px; padding: 15px; background: #e8f5e9; border-radius: 8px; border-left: 4px solid #4caf50;">
                <p style="margin: 0; font-size: 0.9em; color: #2e7d32;">
                    <strong>Privacy Note:</strong> Your date of birth is only used for age verification and is not stored.
                </p>
            </div>
        </div>
    </div>

    <!-- Parental Control Panel Modal -->
    <div class="modal" id="parental-control-panel" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; align-items: center; justify-content: center;">
        <div style="background: white; border-radius: 20px; padding: 40px; max-width: 700px; width: 90%; max-height: 90vh; overflow-y: auto;">
            <h2 style="margin-top: 0; color: #667eea;">üë®‚Äçüë©‚Äçüëß Parental Control Panel</h2>
            <p style="color: #666; margin-bottom: 30px;">Manage your child's age settings and learning modules.</p>

            <!-- Age Settings -->
            <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; margin-bottom: 25px;">
                <h3 style="color: #667eea; margin-top: 0;">üë∂ Child's Age Settings</h3>
                <div style="margin: 15px 0;">
                    <label style="display: block; font-weight: bold; color: #333; margin-bottom: 10px;">Current Age:</label>
                    <input type="text" id="panel-current-age" disabled style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1.1em; font-weight: bold; color: #667eea; background: white; box-sizing: border-box;">
                </div>
                <div style="margin: 15px 0;">
                    <label style="display: block; font-weight: bold; color: #333; margin-bottom: 10px;">Change Age To:</label>
                    <select id="panel-new-age" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em; box-sizing: border-box;">
                        <option value="">Keep current age</option>
                        <option value="4">4 years old</option>
                        <option value="5">5 years old</option>
                        <option value="6">6 years old</option>
                        <option value="7">7 years old</option>
                        <option value="8">8 years old</option>
                        <option value="9">9 years old</option>
                        <option value="10">10 years old</option>
                        <option value="11">11 years old</option>
                        <option value="12">12 years old</option>
                        <option value="13">13+ years old</option>
                    </select>
                </div>
            </div>

            <!-- Module Management -->
            <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; margin-bottom: 25px;">
                <h3 style="color: #667eea; margin-top: 0;">üìö Learning Modules</h3>
                <p style="color: #666; margin-bottom: 15px; font-size: 0.95em;">Enable or disable modules for your child:</p>
                <div style="display: grid; gap: 10px;">
                    <label style="display: flex; align-items: center; padding: 15px; background: white; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; transition: all 0.3s;">
                        <input type="checkbox" id="panel-toggle-math" style="width: 20px; height: 20px; margin-right: 12px; cursor: pointer;">
                        <span style="font-size: 1.05em;">üìê Mathematics</span>
                    </label>
                    <label style="display: flex; align-items: center; padding: 15px; background: white; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; transition: all 0.3s;">
                        <input type="checkbox" id="panel-toggle-english" style="width: 20px; height: 20px; margin-right: 12px; cursor: pointer;">
                        <span style="font-size: 1.05em;">üìö English</span>
                    </label>
                    <label style="display: flex; align-items: center; padding: 15px; background: white; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; transition: all 0.3s;">
                        <input type="checkbox" id="panel-toggle-aptitude" style="width: 20px; height: 20px; margin-right: 12px; cursor: pointer;">
                        <span style="font-size: 1.05em;">üß© Aptitude</span>
                    </label>
                    <label style="display: flex; align-items: center; padding: 15px; background: white; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; transition: all 0.3s;">
                        <input type="checkbox" id="panel-toggle-stories" style="width: 20px; height: 20px; margin-right: 12px; cursor: pointer;">
                        <span style="font-size: 1.05em;">üìñ Stories</span>
                    </label>
                    <label style="display: flex; align-items: center; padding: 15px; background: white; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; transition: all 0.3s;">
                        <input type="checkbox" id="panel-toggle-emotional-quotient" style="width: 20px; height: 20px; margin-right: 12px; cursor: pointer;">
                        <span style="font-size: 1.05em;">‚ù§Ô∏è Emotional Quotient</span>
                    </label>
                    <label style="display: flex; align-items: center; padding: 15px; background: white; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; transition: all 0.3s;">
                        <input type="checkbox" id="panel-toggle-drawing" style="width: 20px; height: 20px; margin-right: 12px; cursor: pointer;">
                        <span style="font-size: 1.05em;">üé® Drawing</span>
                    </label>
                    <label style="display: flex; align-items: center; padding: 15px; background: white; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; transition: all 0.3s;">
                        <input type="checkbox" id="panel-toggle-german-kids" style="width: 20px; height: 20px; margin-right: 12px; cursor: pointer;">
                        <span style="font-size: 1.05em;">üá©üá™ German Kids</span>
                    </label>
                </div>
            </div>

            <div id="panel-error" style="color: #e74c3c; font-weight: bold; margin: 15px 0; display: none;"></div>

            <div style="display: flex; gap: 10px; margin-top: 30px;">
                <button onclick="saveParentalControlChanges()" class="btn btn-primary" style="flex: 1;">
                    üíæ Save All Changes
                </button>
                <button onclick="closeParentalControlPanel()" class="btn btn-secondary" style="flex: 1;">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;

        // Wait for Firebase auth
        firebase.auth().onAuthStateChanged(async function(user) {
            if (!user) {
                window.location.href = 'login.html';
                return;
            }

            await loadUserProfile();
        });

        async function loadUserProfile() {
            try {
                const firebaseUser = firebase.auth().currentUser;
                if (!firebaseUser) {
                    showError('Not authenticated');
                    return;
                }

                // Fetch user data from Firestore by email
                const userQuery = await firebase.firestore().collection('users')
                    .where('email', '==', firebaseUser.email.toLowerCase())
                    .limit(1)
                    .get();

                if (userQuery.empty) {
                    showError('User profile not found');
                    return;
                }

                const userDoc = userQuery.docs[0];
                const userData = userDoc.data();
                userData.uid = firebaseUser.uid; // Add UID for updates

                currentUser = userData;

                // Populate fields
                document.getElementById('username').value = userData.username || '';
                document.getElementById('fullname').value = userData.fullName || '';
                document.getElementById('email').value = userData.email || '';
                document.getElementById('role').value = userData.role || 'student';

                // Display current age
                const ageDisplay = userData.age ? `${userData.age} years old` : 'Not set';
                document.getElementById('current-age-display').value = ageDisplay;

                // Display enabled modules (what parent has enabled for child)
                displayModules(userData.enabledModules || userData.modules || {});
            } catch (error) {
                console.error('Error loading user profile:', error);
                showError('Failed to load user data: ' + error.message);
            }
        }

        function displayModules(modules) {
            const moduleNames = {
                math: 'üìê Mathematics',
                english: 'üìö English',
                aptitude: 'üß© Aptitude',
                stories: 'üìñ Stories',
                'emotional-quotient': '‚ù§Ô∏è Emotional Quotient',
                german: 'üá©üá™ German B1',
                drawing: 'üé® Drawing',
                'german-kids': 'üá©üá™ German Kids'
            };

            let html = '<div style="display: flex; flex-wrap: wrap;">';
            let enabledCount = 0;

            // Only show enabled modules
            for (const [key, enabled] of Object.entries(modules)) {
                if (enabled) {
                    const name = moduleNames[key] || key;
                    html += `<span class="module-badge">${name}</span>`;
                    enabledCount++;
                }
            }

            html += '</div>';

            if (enabledCount === 0) {
                html = '<p style="color: #999;">No modules enabled yet. Use Parental Control to enable modules.</p>';
            }

            document.getElementById('modules-display').innerHTML = html;
        }

        async function saveProfile() {
            if (!currentUser) return;

            const fullName = document.getElementById('fullname').value.trim();

            if (!fullName) {
                showError('Full name is required');
                return;
            }

            try {
                const userDoc = firebase.firestore().collection('users').doc(currentUser.uid.substring(0, 20));
                await userDoc.update({
                    fullName: fullName
                });

                // Update local cache
                currentUser.fullName = fullName;

                showSuccess('Profile updated successfully!');
            } catch (error) {
                console.error('Error updating profile:', error);
                showError('Failed to update profile: ' + error.message);
            }
        }

        // Parental Control Functions
        function openParentalControl() {
            document.getElementById('parent-verification-modal').style.display = 'flex';
            document.getElementById('parent-dob-input').value = '';
            document.getElementById('parent-verification-error').style.display = 'none';

            // Set max date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('parent-dob-input').max = today;

            setTimeout(() => {
                document.getElementById('parent-dob-input').focus();
            }, 100);
        }

        function closeParentVerification() {
            document.getElementById('parent-verification-modal').style.display = 'none';
        }

        function verifyParentAge() {
            const dobInput = document.getElementById('parent-dob-input').value;
            const errorDiv = document.getElementById('parent-verification-error');

            if (!dobInput) {
                errorDiv.textContent = 'Please select your date of birth';
                errorDiv.style.display = 'block';
                return;
            }

            // Calculate age
            const dob = new Date(dobInput);
            const today = new Date();
            let age = today.getFullYear() - dob.getFullYear();
            const monthDiff = today.getMonth() - dob.getMonth();

            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < dob.getDate())) {
                age--;
            }

            // Check if age is 25 or more
            if (age < 25) {
                errorDiv.textContent = 'Parental Control is only available for users 25 years or older';
                errorDiv.style.display = 'block';
                return;
            }

            // Age verified - open parental control panel
            closeParentVerification();
            openParentalControlPanel();
        }

        function openParentalControlPanel() {
            document.getElementById('parental-control-panel').style.display = 'flex';
            document.getElementById('panel-error').style.display = 'none';

            // Load current age
            if (currentUser) {
                const ageDisplay = currentUser.age ? `${currentUser.age} years old` : 'Not set';
                document.getElementById('panel-current-age').value = ageDisplay;

                // Get assigned modules (what admin has made available)
                const assignedModules = currentUser.modules || {};
                // Get enabled modules (what parent has enabled) - fallback to modules if enabledModules doesn't exist
                const enabledModules = currentUser.enabledModules || currentUser.modules || {};

                // Module list
                const allModules = [
                    { key: 'math', id: 'panel-toggle-math' },
                    { key: 'english', id: 'panel-toggle-english' },
                    { key: 'aptitude', id: 'panel-toggle-aptitude' },
                    { key: 'stories', id: 'panel-toggle-stories' },
                    { key: 'emotional-quotient', id: 'panel-toggle-emotional-quotient' },
                    { key: 'drawing', id: 'panel-toggle-drawing' },
                    { key: 'german-kids', id: 'panel-toggle-german-kids' }
                ];

                // Update each module checkbox
                allModules.forEach(module => {
                    const checkbox = document.getElementById(module.id);
                    const label = checkbox.closest('label');

                    if (assignedModules[module.key]) {
                        // Module is assigned by admin - show and enable it
                        label.style.display = 'flex';
                        checkbox.disabled = false;
                        checkbox.checked = enabledModules[module.key] || false;
                    } else {
                        // Module not assigned by admin - hide it
                        label.style.display = 'none';
                    }
                });
            }
        }

        function closeParentalControlPanel() {
            document.getElementById('parental-control-panel').style.display = 'none';
        }

        async function saveParentalControlChanges() {
            if (!currentUser) return;

            const errorDiv = document.getElementById('panel-error');
            const newAge = document.getElementById('panel-new-age').value;

            try {
                const userDoc = firebase.firestore().collection('users').doc(currentUser.uid.substring(0, 20));
                const updates = {};

                // Update age if changed
                if (newAge) {
                    updates.age = parseInt(newAge);
                    currentUser.age = parseInt(newAge);
                }

                // Update enabled modules (parent controls these)
                const enabledModules = {
                    math: document.getElementById('panel-toggle-math').checked,
                    english: document.getElementById('panel-toggle-english').checked,
                    aptitude: document.getElementById('panel-toggle-aptitude').checked,
                    stories: document.getElementById('panel-toggle-stories').checked,
                    'emotional-quotient': document.getElementById('panel-toggle-emotional-quotient').checked,
                    drawing: document.getElementById('panel-toggle-drawing').checked,
                    'german-kids': document.getElementById('panel-toggle-german-kids').checked
                };

                // Add enabled module updates
                for (const [key, value] of Object.entries(enabledModules)) {
                    updates[`enabledModules.${key}`] = value;
                }

                // Save to Firestore
                await userDoc.update(updates);

                // Update local cache
                currentUser.enabledModules = enabledModules;

                closeParentalControlPanel();
                showSuccess('Settings updated successfully! Page will reload to apply changes.');

                // Reload after 2 seconds
                setTimeout(() => {
                    window.location.reload();
                }, 2000);
            } catch (error) {
                console.error('Error saving parental control changes:', error);
                errorDiv.textContent = 'Failed to save changes: ' + error.message;
                errorDiv.style.display = 'block';
            }
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('success-message');
            successDiv.textContent = message;
            successDiv.style.display = 'block';

            // Hide error message
            document.getElementById('error-message').style.display = 'none';

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });

            // Auto-hide after 5 seconds
            setTimeout(() => {
                successDiv.style.display = 'none';
            }, 5000);
        }

        function showError(message) {
            const errorDiv = document.getElementById('error-message');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';

            // Hide success message
            document.getElementById('success-message').style.display = 'none';

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Close modals on background click
        document.getElementById('parent-verification-modal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeParentVerification();
            }
        });

        document.getElementById('parental-control-panel').addEventListener('click', function(event) {
            if (event.target === this) {
                closeParentalControlPanel();
            }
        });
    </script>
</body>
</html>
